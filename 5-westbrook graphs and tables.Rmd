```{r load data}
baseDir <- getwd() # works as long as you have the project loaded in RStudio - does not work for kniting

dataInDir <- paste0(baseDir, '/dataIn/')
dataOutDir <- paste0(baseDir, '/dataOut/')
dataLocalDir <- paste0(baseDir, '/localData/')
graphsDir <- paste0(baseDir, '/graphs/')
codeDir <- paste0(baseDir, '/code/')

load(paste0(dataLocalDir,'means.RData'))

```

```{r means tables}

intersectSeveral <- function(...) { Reduce(intersect, list(...)) } 

# exclude the variables in the grep() statement
# intersect works on pairs. the intersectSeveral function generates the intersectin of multiple lists
keepRows <- 
  intersectSeveral(grep("residuals", x=ggs.wb$Parameter,invert=TRUE),
                   grep("stream.mu", x=ggs.wb$Parameter,invert=TRUE),
                   grep("rho.B.year",x=ggs.wb$Parameter,invert=TRUE)
                  )

rHat <- unique( ggs_Rhat(ggs.wb[keepRows,])$data )

# table of parameter estimates for MS
m <- left_join(means,rHat[,c('Parameter','Rhat')])




ggs_caterpillar(ggs.wb[keepRows,])



```




```{r predictions of cubic by year}

pC <- predCubic(means)

ggCubic <- ggplot(pC$predCubic, aes(dOY,pred)) + geom_line(aes(color=factor(year)),size=1.25)

ggCubic + geom_point(aes(maxX,maxY), data = pC$bY)

# max temp over years
ggplot(pC$bY, aes(year,maxY)) + geom_point() + geom_smooth(method="lm")

# day of max temp over years
ggplot(pC$bY, aes(year,maxX)) + geom_point() + geom_smooth(method="lm")

# day of max temp over years
bYM <- melt(pC$bY[,c('year','dOYMinus2','dOYMinus1','dOYPlus1','dOYPlus2')],id='year') 
bYM$std <- ifelse(bYM$variable %in% c('dOYMinus1','dOYPlus1'), 1, 2 ) 
bYM$tempAdj <- bYM$value + 18 # 18 for now as a fill-in

predCubicStd <- 
  ggplot(bYM, aes(year,tempAdj,color=variable,shape=variable)) +
  geom_point(size=3) +
  geom_smooth(method="lm") +
  facet_wrap(~std, scales = "free")

ggsave( file=paste0(graphsDir,'predCubicStd.png'), plot=predCubicStd, dpi=600 , width=6,height=6, units='in' )

# none of these is significant
summary(lm( tempAdj ~ year, data=bYM[bYM$variable == 'dOYMinus2',] ))
summary(lm( tempAdj ~ year, data=bYM[bYM$variable == 'dOYMinus1',] ))
summary(lm( tempAdj ~ year, data=bYM[bYM$variable == 'dOYPlus1',] ))
summary(lm( tempAdj ~ year, data=bYM[bYM$variable == 'dOYPlus2',] ))
```
